(this["webpackJsonpbeer-local-client"]=this["webpackJsonpbeer-local-client"]||[]).push([[13],{1433:function(e,r,t){"use strict";t.r(r);var a=t(110),n=t(68),c=t(0),l=t.n(c),i=t(30),o=t(43),s=t(130),d=t(29),u=t(924),m=t(925),f=t(919),p=t(319),b=t(955),E=t(177),O=t(178),g=t(128),h="beerlocal/ProducerOrdersPage/FETCH_ORDERS",C="beerlocal/ProducerOrdersPage/FETCH_ORDERS_SUCCESS",v="beerlocal/ProducerOrdersPage/FETCH_ORDERS_ERROR",y="beerlocal/ProducerOrdersPage/EDIT_ORDER",j="beerlocal/ProducerOrdersPage/EDIT_ORDER_SUCCESS",x="beerlocal/ProducerOrdersPage/EDIT_ORDER_ERROR",k="beerlocal/ProducerOrdersPage/CLEAR_ORDERS",w={fetchingOrders:!1,fetchOrdersError:!1,editingOrder:!1,editOrderError:!1,orders:!1},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,r=arguments.length>1?arguments[1]:void 0;return Object(g.a)(e,(function(e){switch(r.type){default:break;case h:e.fetchOrdersError=!1,e.fetchingOrders=!0;break;case C:r.orders&&(e.orders=r.orders,e.fetchOrdersError=!1),e.fetchingOrders=!1;break;case v:e.fetchOrdersError=!0,e.fetchingOrders=!1;break;case y:r.editObj&&(e.editOrderError=!1,e.editingOrder=r.editObj._id);break;case j:r.order&&(e.orders.orders=e.orders.orders.map((function(e){return e._id===r.order._id?r.order:e})),e.editOrderError=!1),e.editingOrder=!1;break;case x:e.editOrderError=!0,e.editingOrder=!1;break;case k:e.orders=!1}}))},P=t(13),R=t.n(P),_=t(36),D=t(16);var H=t(91),I=R.a.mark(Q),T=R.a.mark(Y),F=R.a.mark(L),A=R.a.mark(q),N=R.a.mark(z);function Q(){var e,r,t,a;return R.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Object(D.a)(H.a);case 3:return e=n.sent,r=function(){return e.get("/orders")},n.next=7,Object(D.a)(r);case 7:if(t=n.sent,a=Object(_.a)({},t.data),!t.data){n.next=12;break}return n.next=12,Object(D.c)({type:C,orders:a});case 12:n.next=18;break;case 14:return n.prev=14,n.t0=n.catch(0),n.next=18,Object(D.c)((c=n.t0,{type:v,error:c}));case 18:case"end":return n.stop()}var c}),I,null,[[0,14]])}function Y(e){var r,t,a,n;return R.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return r=e.editObj,c.prev=1,c.next=4,Object(D.a)(H.a);case 4:return t=c.sent,a=function(){return t.patch("/orders/".concat(r._id),r)},c.next=8,Object(D.a)(a);case 8:if(!(n=c.sent).data){c.next=12;break}return c.next=12,Object(D.c)((i=n.data.order,{type:j,order:i}));case 12:c.next=18;break;case 14:return c.prev=14,c.t0=c.catch(1),c.next=18,Object(D.c)((l=c.t0,{type:x,error:l}));case 18:case"end":return c.stop()}var l,i}),T,null,[[1,14]])}function L(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.b)(2e3,h,Q);case 2:case"end":return e.stop()}}),F)}function q(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.b)(2e3,y,Y);case 2:case"end":return e.stop()}}),A)}function z(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.d)(L);case 2:return e.next=4,Object(D.d)(q);case 4:case"end":return e.stop()}}),N)}var B=function(e){return e.ProducerOrdersPage||w},M=t(100),V=t(1413),J=t(472),U=t(920),W=t(990),G=t.n(W),X=t(938),K=t(129),Z=t(952),$=t(958),ee=t(167),re=t(87),te=Object(d.b)({userProfile:Object(re.e)(),orderEditing:Object(d.a)(B,(function(e){return e.editingOrder}))});var ae=Object(i.c)(te,(function(e){return{orderEdit:function(r){return e(function(e){return{type:y,editObj:e}}(r))}}})),ne=Object(o.d)(ae)((function(e){var r=e.userProfile,t=e.ordersInfo,a=e.order,i=e.index,o=e.orderEdit,s=e.orderEditing,d=Object(c.useState)(Object(_.a)({},a)),u=Object(n.a)(d,2),m=u[0],p=u[1],b=r.role;Object(c.useEffect)((function(){p(Object(_.a)({},a))}),[a]);var E=function(){var e=Object(M.a)(R.a.mark((function e(){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={_id:m._id,status:"Confirmed"===m.status?"Pending":"Confirmed"},o(r);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(M.a)(R.a.mark((function e(){var r,t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=a.items.filter((function(e){return"delete"!==e.orderChange})).map((function(e){return Object(_.a)(Object(_.a)({},e),{},{orderChange:""})})),t={_id:m._id,status:"Pending",items:r},o(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=function(){var e=Object(M.a)(R.a.mark((function e(){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={_id:m._id,status:"Rejected"===m.status?"Pending":"Rejected"},o(r);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=Object(M.a)(R.a.mark((function e(){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={_id:m._id,status:"Cancelled"},o(r);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return l.a.createElement(V.a,{mouseEnterDelay:500,trigger:l.a.createElement(f.a.Row,{warning:"producer"===r.role?m.producerNotification:m.retailerNotification,style:{color:("Rejected"===a.status||"Cancelled"===a.status)&&"lightgray"}},l.a.createElement(f.a.Cell,null,"SO-".concat(a.orderNumber.toString().padStart(6,"0"))),l.a.createElement(f.a.Cell,null,G()(a.createdAt).format("DD/MM/YYYY")),l.a.createElement(f.a.Cell,null,l.a.createElement(J.a,{style:{marginLeft:"0.5em"},src:t.businesses[i].avatarSource||"/images/avatars/blank-avatar.webp",alt:"user avatar",avatar:!0}),"retailer"===r.role?l.a.createElement(K.a,{to:"/brewery/".concat(t.businesses[i].businessId)},t.businesses[i].businessName):l.a.createElement(l.a.Fragment,null,t.businesses[i].businessName)),l.a.createElement(f.a.Cell,null,l.a.createElement(X.a,{displayType:"text",thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,prefix:"\xa3",value:Object(Z.a)(a.items)})),l.a.createElement(f.a.Cell,{style:{fontWeight:"Confirmed"===a.status&&"bold"}},a.status),l.a.createElement(f.a.Cell,{textAlign:"center",width:2},l.a.createElement(K.a,{to:"/order/".concat(a._id)},"View Details")),l.a.createElement(f.a.Cell,{textAlign:"center"},l.a.createElement(ee.a,{role:b,perform:"orders:confirm",yes:function(){return("Pending"===m.status||"Confirmed"===m.status)&&l.a.createElement(U.a,{loading:s===m._id,onClick:E,basic:"Confirmed"!==m.status,color:"green",icon:"check",title:"Confirm order"})}}),l.a.createElement(ee.a,{role:b,perform:"orders:changes-confirm",yes:function(){return"Changes pending"===m.status&&l.a.createElement(U.a,{loading:s===m._id,onClick:O,color:"green",icon:"check",title:"Approve changes"})}}),l.a.createElement(ee.a,{role:b,perform:"orders:reject",yes:function(){return("Changes pending"===m.status||"Pending"===m.status||"Rejected"===m.status)&&l.a.createElement(U.a,{loading:s===m._id,onClick:g,basic:"Rejected"!==m.status,color:"red",icon:"ban",title:"Reject order"})}}),l.a.createElement(ee.a,{role:b,perform:"orders:cancel",yes:function(){return("Changes pending"===m.status||"Pending"===m.status)&&l.a.createElement(U.a,{loading:s===m._id,onClick:h,basic:"Cancelled"!==m.status,color:"red",icon:"close",title:"Cancel order"})}}))),content:l.a.createElement(l.a.Fragment,null,l.a.createElement($.a,{orderItems:a.items,businessName:t.businesses[i].businessName,type:"orderInfo"})),basic:!0,wide:"very"})})),ce=t(314),le=Object(d.b)({ordersInfo:Object(d.a)(B,(function(e){return e.orders})),userProfile:Object(re.e)()});var ie=Object(i.c)(le,(function(e){return{ordersFetch:function(){return e({type:h})},ordersClear:function(){return e({type:k})}}}));r.default=Object(o.d)(ie)((function(e){var r=e.ordersInfo,t=e.ordersFetch,i=e.ordersClear,o=e.userProfile;Object(E.a)({key:"ProducerOrdersPage",reducer:S}),Object(O.a)({key:"ProducerOrdersPage",saga:z});var d=Object(s.b)().isAuthenticated,g=Object(c.useState)([]),h=Object(n.a)(g,2),C=h[0],v=h[1],y=Object(c.useState)(""),j=Object(n.a)(y,2),x=j[0],k=j[1];Object(c.useEffect)((function(){d?t():i()}),[d,t,i]),Object(c.useEffect)((function(){if(r&&r.orders){var e=Object(a.a)(new Set(r&&r.orders.map((function(e){return e.status}))));v(e.map((function(e){return{label:e,value:e}})))}}),[r,r.orders]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(p.Helmet,null,l.a.createElement("title",null,"beerLocal - Order History"),l.a.createElement("meta",{name:"description",content:"Your orders"})),l.a.createElement(ce.a,null,l.a.createElement(u.a,{basic:!0,className:"primary wrapper"},l.a.createElement(m.a,{as:"h1"},"Order History"),l.a.createElement(f.a,{unstackable:!0,basic:"very"},l.a.createElement(f.a.Header,null,l.a.createElement(f.a.Row,null,l.a.createElement(f.a.HeaderCell,null,"Order no."),l.a.createElement(f.a.HeaderCell,null,"Order date"),l.a.createElement(f.a.HeaderCell,null,"producer"===o.role?"Purchaser":"Brewery"),l.a.createElement(f.a.HeaderCell,null,"Total"),l.a.createElement(f.a.HeaderCell,{colSpan:3},l.a.createElement(b.a,{options:C,placeholder:"Filter",onChange:function(e,r){"clear"===r.action&&k(""),e&&k(e.value)},defaultValue:"",isClearable:!0,escapeClearsValue:!0})))),l.a.createElement(f.a.Body,null,r&&r.businesses&&r.orders.filter((function(e){return!x||e.status===x})).map((function(e,t){return l.a.createElement(l.a.Fragment,{key:e._id},l.a.createElement(ne,{ordersInfo:r,order:e,index:t}))})))))))}))},952:function(e,r,t){"use strict";r.a=function(e){return e.reduce((function(e,r){return e+="delete"!==r.orderChange&&r.price*r.orderQuant}),0)}},958:function(e,r,t){"use strict";var a=t(68),n=t(0),c=t.n(n),l=t(1431),i=t(925),o=t(919),s=t(920),d=t(922),u=t(1414),m=t(938),f=t(955),p=t(53),b=t(45);function E(){var e=Object(b.a)(["\n  .quantity-buttons {\n    margin-left: 10px;\n\n    button.primary.button {\n      width: 30px;\n      padding: 7.5px 0;\n    }\n  }\n"]);return E=function(){return e},e}var O=t(46).b.div(E());var g=function(e){var r=e.orderLine,t=e.editingOrder,a=e.handleDeleteItem,n=e.handleDecreaseQuant,l=e.handleIncreaseQuant;return r?c.a.createElement(o.a.Row,{positive:"add"===r.orderChange,key:r.id},c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange},r.name),c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange},c.a.createElement(m.a,{displayType:"text",decimalScale:1,fixedDecimalScale:!0,suffix:"%",value:r.abv})),c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange},p.k[r.packSize]),c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange},c.a.createElement(m.a,{displayType:"text",thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,prefix:"\xa3",value:r.price})),c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange,positive:"increase"===r.orderChange,negative:"decrease"===r.orderChange},c.a.createElement(O,null,c.a.createElement("span",null,r.orderQuant),t&&c.a.createElement(s.a.Group,{className:"quantity-buttons",size:"mini",compact:!0},c.a.createElement(s.a,{primary:!0,basic:!0,icon:"minus",onClick:function(){return n(r.id)},title:"Decrease quantity"}),c.a.createElement(s.a,{primary:!0,basic:!0,icon:"plus",onClick:function(){return l(r.id)},title:"Increase quantity"})))),c.a.createElement(o.a.Cell,{disabled:"delete"===r.orderChange},c.a.createElement(m.a,{displayType:"text",thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,prefix:"\xa3",value:r.price*r.orderQuant})),t&&c.a.createElement(o.a.Cell,{textAlign:"center"},c.a.createElement(s.a,{color:"red",size:"mini",icon:"close",title:"Cancel item",onClick:function(){return a(r.id)}}))):null};r.a=function(e){var r=e.editingOrder,t=e.businessName,p=e.orderItems,b=e.distancePurchase,E=e.deliveryInstruction,O=e.distantPurchasingConditions,h=e.distantPurchasingMinimumMet,C=e.availableStock,v=e.handleAddItem,y=e.handleDeleteItem,j=e.handleDecreaseQuant,x=e.handleIncreaseQuant,k=e.type,w=Object(n.useState)({}),S=Object(a.a)(w,2),P=S[0],R=S[1],_=Object(n.useState)(!1),D=Object(a.a)(_,2),H=D[0],I=D[1];return p?c.a.createElement(l.a.Content,{style:{overflowX:"scroll"}},"draftOrder"===k&&c.a.createElement(c.a.Fragment,null,c.a.createElement(i.a,{as:"h5"},"Your order from ".concat(t)),c.a.createElement("p",null,"This is the contents of your order. Click below to confirm, or cancel to go back.")),c.a.createElement(o.a,{celled:!0,unstackable:!0,style:{minWidth:"600px"}},c.a.createElement(o.a.Header,null,c.a.createElement(o.a.Row,null,c.a.createElement(o.a.HeaderCell,null,"Name"),c.a.createElement(o.a.HeaderCell,null,"ABV"),c.a.createElement(o.a.HeaderCell,null,"Pack Size"),c.a.createElement(o.a.HeaderCell,null,"List Price"),c.a.createElement(o.a.HeaderCell,null,"Order #"),c.a.createElement(o.a.HeaderCell,null,"Total"),r&&c.a.createElement(o.a.HeaderCell,null))),c.a.createElement(o.a.Body,null,p.filter((function(e){return e.orderQuant})).map((function(e){return c.a.createElement(c.a.Fragment,{key:e.id},c.a.createElement(g,{orderLine:e,editingOrder:r,handleDeleteItem:y,handleDecreaseQuant:j,handleIncreaseQuant:x}))}))),c.a.createElement(o.a.Footer,null,r&&!H&&c.a.createElement(o.a.Row,null,c.a.createElement(o.a.HeaderCell,{colSpan:"16"},c.a.createElement(s.a,{attached:!0,basic:!0,icon:"plus",content:"Add item",onClick:function(){return I(!0)}}))),r&&H&&c.a.createElement(o.a.Row,null,c.a.createElement(o.a.HeaderCell,{colSpan:"7"},c.a.createElement(d.a,{columns:2},c.a.createElement(d.a.Column,{width:12},c.a.createElement(f.a,{options:C,onChange:function(e){R(e)},placeholder:"Select item"})),c.a.createElement(d.a.Column,{width:4},c.a.createElement(s.a,{icon:"add",primary:!0,fluid:!0,content:"Add",onClick:function(){v(P),I(!1)}}))))),c.a.createElement(o.a.Row,null,c.a.createElement(o.a.HeaderCell,{colSpan:r?6:5,textAlign:"right"},"Estimated Total:"),c.a.createElement(o.a.HeaderCell,null,c.a.createElement(m.a,{displayType:"text",thousandSeparator:!0,decimalScale:2,fixedDecimalScale:!0,prefix:"\xa3",value:p.reduce((function(e,r){return e+="delete"!==r.orderChange&&r.price*r.orderQuant}),0)}))))),b&&!h&&c.a.createElement(u.a,{warning:!0},c.a.createElement(u.a.Header,null,"You are outside this brewery's distribution area"),c.a.createElement("p",null,"To process your order, you must spent at least \xa3",Number(O.minSpend).toFixed(2),".")),E&&c.a.createElement(u.a,{info:!0},c.a.createElement(u.a.Header,null,"The following delivery instructions will be passed along with your order:"),c.a.createElement("p",null,E))):null}}}]);
//# sourceMappingURL=13.1c0ec98a.chunk.js.map